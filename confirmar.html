<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Confirmación de asistencia</title>
<style>
body{font-family:Arial;background:#f8f5f2;padding:20px;text-align:center;}
.container{background:white;padding:20px;border-radius:10px;max-width:500px;margin:auto;box-shadow:0 0 10px rgba(0,0,0,0.1);}
select,input,button{width:100%;padding:10px;margin-top:10px;border-radius:5px;border:1px solid #ccc;}
button{background:#b38b59;color:white;border:none;font-size:18px;}
button:hover{background:#8d6e63;}
</style>
</head>
<body>

<div class="container">
<h1>Confirmación de asistencia</h1>
<p id="nombre">Cargando invitado...</p>

<form id="form">
<label>Adultos que asistirán:</label>
<select id="adultos" required></select>

<label>Niños que asistirán:</label>
<select id="ninos" required></select>

<label>Alergias:</label>
<input id="alergias">

<label>Comentarios:</label>
<input id="comentarios">

<button type="submit">Confirmar asistencia</button>
</form>

<p id="mensaje"></p>
</div>

<script>
const endpoint = "https://script.google.com/macros/s/AKfycbxwMYawr3_4_W3_PB_xerEO7-Mg3HBVdaYtW2s4YGlLQbqazcQreosVYpitp1H89VKqaA/exec";

// 1️⃣ Capturamos el código del link
const urlParams = new URLSearchParams(window.location.search);
const codigo = urlParams.get('codigo');

if(!codigo){
    document.getElementById("nombre").innerText = "⚠️ Código no encontrado en el link";
}

// 2️⃣ Traer datos del invitado desde Google Sheets
fetch(endpoint + "?codigo=" + codigo)
.then(res => res.json())
.then(data => {
    if(!data.nombre){
        document.getElementById("nombre").innerText = "⚠️ Invitado no encontrado";
        return;
    }
    document.getElementById("nombre").innerText = "Invitado: " + data.nombre;

    // Llenar select de adultos
    for(let i=0;i<=data.adultos;i++){
        const option = document.createElement("option");
        option.value = i;
        option.textContent = i;
        document.getElementById("adultos").appendChild(option);
    }

    // Llenar select de niños
    for(let i=0;i<=data.ninos;i++){
        const option = document.createElement("option");
        option.value = i;
        option.textContent = i;
        document.getElementById("ninos").appendChild(option);
    }
});

// 3️⃣ Enviar confirmación
document.getElementById("form").addEventListener("submit", e=>{
    e.preventDefault();
    if(!codigo) return;

    fetch(endpoint, {
        method:"POST",
        body: JSON.stringify({
            codigo: codigo,
            adultos: document.getElementById("adultos").value,
            ninos: document.getElementById("ninos").value,
            alergias: document.getElementById("alergias").value,
            comentarios: document.getElementById("comentarios").value
        })
    })
    .then(res => res.text())
    .then(()=>{
        document.getElementById("mensaje").innerText = "✅ Confirmación guardada";
        document.getElementById("form").reset();
    });
});
</script>

</body>
</html>
